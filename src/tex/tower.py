names = [ 
			"piano",
			"level",
			[
				[
					"nord",
					"ala",
					[
						[
							"destra",
							"zona",
							[
								["room_1", "room", [] ],
								["room_2", "room", [] ],
								["room_3", "room", [] ],
								["room_4", "room", [] ],
								["room_5", "room", [] ],
								["room_6", "room", [] ],
								["room_7", "room", [] ],
								["room_8", "room", [] ],
								["room_9", "room", [] ]
							] 
						],
						   [
							   "sinistra",
							"zona",
							   [
								["room_1", "room", [] ],
								["room_2", "room", [] ],
								["room_3", "room", [] ],
								["room_4", "room", [] ],
								["room_5", "room", [] ],
								["room_6", "room", [] ],
								["room_7", "room", [] ],
								["room_8", "room", [] ],
								["room_9", "room", [] ]
							   ]
						   ],
						   [
							   "connettivo",
							"zona",
							   [
								   ["room_1", "room", [] ]
							   ]
						   ],
						   [
							   "ascensore",
							"zona",
							   [
								   ["room_1", "room", [] ],
								   ["room_2", "room", [] ]
							   ]
						   ],
						  [
							  "scale",
							"zona",
							  [
								  ["room_1", "room", [] ]
							  ]
						  ],
						   [
							   "servizi",
							"zona",
							   [
								   ["room_1", "room", [] ],
								   ["room_2", "room", [] ],
								   ["room_3", "room", [] ]
							   ]                                                
						]
					]
				],
				[
					"sud",
					"ala",
					[
						[
							"destra",
							"zona",
							[
								["room_1", "room", [] ],
								["room_2", "room", [] ],
								["room_3", "room", [] ],
								["room_4", "room", [] ],
								["room_5", "room", [] ],
								["room_6", "room", [] ],
								["room_7", "room", [] ],
								["room_8", "room", [] ],
								["room_9", "room", [] ],
								["room_10", "room", [] ],
								["room_11", "room", [] ]
							] 
						],
						   [
							   "sinistra",
							"zona",
							   [
								["room_1", "room", [] ],
								["room_2", "room", [] ],
								["room_3", "room", [] ],
								["room_4", "room", [] ],
								["room_5", "room", [] ],
								["room_6", "room", [] ],
								["room_7", "room", [] ],
								["room_8", "room", [] ],
								["room_9", "room", [] ]
							   ]
						   ],
						   [
							   "connettivo",
							"zona",
							   [
								   ["room_1", "room", [] ]
							   ]
						   ],
						   [
							   "ascensore",
							"zona",
							   [
								   ["room_1", "room", [] ]
							   ]
						   ],
						  [
							  "scale",
							"zona",
							  [
								  ["room_1", "room", [] ]
							  ]
						  ],
						   [
							   "servizi",
							"zona",
							   [
								   ["room_1", "room", [] ],
								   ["room_2", "room", [] ],
								   ["room_3", "room", [] ],
								   ["room_4", "room", [] ],
								   ["room_5", "room", [] ]
							]                                                
						]
					]
				],
				[
					"est",
					"ala",
					[
						[
							"destra",
							"zona",
							[
								["room_1", "room", [] ],
								["room_2", "room", [] ],
								["room_3", "room", [] ],
								["room_4", "room", [] ],
								["room_5", "room", [] ],
								["room_6", "room", [] ],
								["room_7", "room", [] ],
								["room_8", "room", [] ],
								["room_9", "room", [] ],
								["room_10", "room", [] ]
							] 
						],
						   [
							   "sinistra",
							"zona",
							   [
								["room_1", "room", [] ],
								["room_2", "room", [] ],
								["room_3", "room", [] ],
								["room_4", "room", [] ],
								["room_5", "room", [] ],
								["room_6", "room", [] ],
								["room_7", "room", [] ],
								["room_8", "room", [] ]
							   ]
						   ],
						   [
							   "connettivo",
							"zona",
							   [
								["room_1", "room", [] ]
							   ]
						   ],
						   [
							   "ascensore",
							"zona",
							   [
								["room_1", "room", [] ]
							   ]
						   ],
						  [
							  "scale",
							"zona",
							  [
								["room_1", "room", [] ]
							  ]
						  ],
						   [
							   "servizi",
							"zona",
							   [
								["room_1", "room", [] ],
								["room_2", "room", [] ]
							   ]                                                
						]
					]
				],
				[
					"ovest",
					"ala",
					[
						[
							"destra",
							"zona",
							[
								["room_1", "room",  [] ],
								["room_2", "room",  [] ],
								["room_3", "room",  [] ],
								["room_4", "room",  [] ],
								["room_5", "room",  [] ],
								["room_6", "room",  [] ],
								["room_7", "room",  [] ],
								["room_8", "room",  [] ],
								["room_9", "room",  [] ],
								["room_10", "room", [] ],
								["room_11", "room", [] ],
								["room_12", "room", [] ],
								["room_13", "room", [] ],
								["room_14", "room", [] ]
							] 
						],
						   [
							   "sinistra",
							"zona",
							   [
								["room_1", "room",  [] ],
								["room_2", "room",  [] ],
								["room_3", "room",  [] ],
								["room_4", "room",  [] ],
								["room_5", "room",  [] ],
								["room_6", "room",  [] ],
								["room_7", "room",  [] ],
								["room_8", "room",  [] ],
								["room_9", "room",  [] ],
								["room_10", "room", [] ],
								["room_11", "room", [] ],
								["room_12", "room", [] ]
							   ]
						   ],
						   [
							   "connettivo",
							"zona",
							   [
								["room_1", "room",  [] ]
							   ]
						   ],
						   [
							   "ascensore",
							"zona",
							   [
								["room_1", "room",  [] ],
								["room_2", "room",  [] ]
							   ]
						   ],
						  [
							  "scale",
							"zona",
						 
							  [
								["room_1", "room",  [] ]
							  ]
						  ],
						   [
							   "servizi",
							"zona",
							   [
								["room_1", "room",  [] ],
								["room_2", "room",  [] ]

							   ]                                                
						]
					]
				],
				[
					"centro",
					"ala",
					[
						   [
							   "connettivo",
							"zona",
							   [
								["room_1", "room",  [] ]
							   ]
						   ],
						  [
							  "scale",
							"zona",
							  [
								["room_1", "room",  [] ],
								["room_2", "room",  [] ]
							  ]
						  ]
					]
				],
				["4399674360", "external_wall", [] ],
				["4399543504", "external_wall", [] ],
				["4398085400", "external_wall", [] ],
				["4398153808", "external_wall", [] ],
				["4399573832", "external_wall", [] ],
				["4399574768", "external_wall", [] ],
				["4399574408", "external_wall", [] ],
				["4398167608", "external_wall", [] ],
				["4398167968", "external_wall", [] ],
				["4398169480", "external_wall", [] ],
				["4398169696", "external_wall", [] ],
				["4398168832", "external_wall", [] ],
				["4398169192", "external_wall", [] ],
				["4398177816", "external_wall", [] ],
				["4398166384", "external_wall", [] ],
				["4398183560", "external_wall", [] ],
				["4398166960", "external_wall", [] ],
				["4398174360", "external_wall", [] ],
				["4399750968", "external_wall", [] ],
				["4398176016", "external_wall", [] ],
				["4398177168", "external_wall", [] ],
				["4399678960", "external_wall", [] ],
				["4398182696", "external_wall", [] ],
				["4399749384", "external_wall", [] ],
				["4399749888", "external_wall", [] ],
				["4399750464", "external_wall", [] ],
				["4399678096", "external_wall", [] ],
				["4398142384", "external_wall", [] ],
				["4399679104", "external_wall", [] ],
				["4399597040", "external_wall", [] ],
				["4398277120", "external_wall", [] ],
				["4399597544", "external_wall", [] ],
				["4399598336", "external_wall", [] ],
				["4399598984", "external_wall", [] ],
				["4398141520", "external_wall", [] ],
				["4398175152", "external_wall", [] ],
				["4899903536", "external_wall", [] ],
				["4398280648", "external_wall", [] ],
				["4399678744", "external_wall", [] ],
				["4899904040", "external_wall", [] ],
				["4422365624", "external_wall", [] ],
				["4899905480", "external_wall", [] ],
				["4899902024", "external_wall", [] ],
				["4899902960", "external_wall", [] ],
				["4398277048", "external_wall", [] ],
				["4617330056", "external_wall", [] ],
				["4617367992", "external_wall", [] ],
				["4422375328", "external_wall", [] ],
				["4899903680", "external_wall", [] ],
				["4617324376", "external_wall", [] ],
				["4422497632", "external_wall", [] ],
				["4617324232", "external_wall", [] ],
				["4617370656", "external_wall", [] ],
				["4617374248", "external_wall", [] ],
				["4617367352", "external_wall", [] ],
				["4422498064", "external_wall", [] ],
				["4422499576", "external_wall", [] ],
				["4617354560", "external_wall", [] ],
				["4617367704", "external_wall", [] ],
				["4617342416", "external_wall", [] ],
				["4617374392", "external_wall", [] ],
				["4569263712", "external_wall", [] ],
				["4617369648", "external_wall", [] ],
				["4617350824", "external_wall", [] ],
				["4617354848", "external_wall", [] ],
				["4422368288", "external_wall", [] ],
				["4421540968", "external_wall", [] ],
				["4421538664", "external_wall", [] ],
				["4421539816", "external_wall", [] ],
				["4422468600", "external_wall", [] ],
				["4422504104", "external_wall", [] ],
				["4422504248", "external_wall", [] ],
				["4422501656", "external_wall", [] ],
				["4422378560", "external_wall", [] ],
				["4422470112", "external_wall", [] ],
				["4422469608", "external_wall", [] ],
				["4422469824", "external_wall", [] ],
				["4422395664", "external_wall", [] ],
				["4569972248", "external_wall", [] ],
				["4422378848", "external_wall", [] ],
				["4422380000", "external_wall", [] ],
				["4422468888", "external_wall", [] ],
				["4422393936", "external_wall", [] ],
				["4617379352", "external_wall", [] ],
				["4422395592", "external_wall", [] ],
				["4422377624", "external_wall", [] ],
				["4421540464", "external_wall", [] ],
				["4617334512", "external_wall", [] ],
				["4617333720", "external_wall", [] ],
				["4617377984", "external_wall", [] ],
				["4422494400", "external_wall", [] ],
				["4422380648", "external_wall", [] ],
				["4617335368", "external_wall", [] ],
				["4617355488", "external_wall", [] ],
				["4617359160", "external_wall", [] ],
				["4422492888", "external_wall", [] ],
				["4617388256", "external_wall", [] ],
				["4422493392", "external_wall", [] ],
				["4422396384", "external_wall", [] ],
				["4617335008", "external_wall", [] ],
				["4422493608", "external_wall", [] ],
				["4422399832", "external_wall", [] ],
				["4617360664", "external_wall", [] ],
				["4617389264", "external_wall", [] ],
				["4617335728", "external_wall", [] ],
				["4421535216", "external_wall", [] ],
				["4422399040", "external_wall", [] ],
				["4422401056", "external_wall", [] ],
				["4422398752", "external_wall", [] ],
				["4422492312", "external_wall", [] ],
				["4421535504", "external_wall", [] ],
				["4421534064", "external_wall", [] ],
				["4421534280", "external_wall", [] ],
				["4422508272", "external_wall", [] ],
				["4421521704", "external_wall", [] ],
				["4421522496", "external_wall", [] ],
				["4617343416", "external_wall", [] ],
				["4421524872", "external_wall", [] ],
				["4617381144", "external_wall", [] ],
				["4422504960", "external_wall", [] ],
				["4422504888", "external_wall", [] ],
				["4421536080", "external_wall", [] ],
				["4617344712", "external_wall", [] ],
				["4617345792", "external_wall", [] ],
				["4422400768", "external_wall", [] ],
				["4422393152", "external_wall", [] ],
				["4617517032", "external_wall", [] ],
				["4422514448", "external_wall", [] ],
				["4422513800", "external_wall", [] ],
				["4422512864", "external_wall", [] ],
				["4422390272", "external_wall", [] ],
				["4422391568", "external_wall", [] ],
				["4421518328", "external_wall", [] ],
				["4422507480", "external_wall", [] ],
				["4617381432", "external_wall", [] ],
				["4617496696", "external_wall", [] ],
				["4617469824", "external_wall", [] ],
				["4617500216", "external_wall", [] ],
				["4421518760", "external_wall", [] ],
				["4421520776", "external_wall", [] ],
				["4617518544", "external_wall", [] ],
				["4422487576", "external_wall", [] ],
				["4617476648", "external_wall", [] ],
				["4617499928", "external_wall", [] ],
				["4617501296", "external_wall", [] ],
				["4647919200", "external_wall", [] ],
				["4422486784", "external_wall", [] ],
				["4422487072", "external_wall", [] ],
				["4422487216", "external_wall", [] ],
				["4422472696", "external_wall", [] ],
				["4647916752", "external_wall", [] ],
				["4647918336", "external_wall", [] ],
				["4617471904", "external_wall", [] ],
				["4617481680", "external_wall", [] ],
				["4569268168", "external_wall", [] ],
				["4422471976", "external_wall", [] ],
				["4617509200", "external_wall", [] ],
				["4647918048", "external_wall", [] ],
				["4617523280", "external_wall", [] ],
				["4617470032", "external_wall", [] ],
				["4617521056", "external_wall", [] ],
				["4647918624", "external_wall", [] ],
				
				["4617520768", "internal_wall", [] ],
				["4617520624", "internal_wall", [] ],
				["4617519328", "internal_wall", [] ],
				["4398085904", "internal_wall", [] ],
				["4398162072", "internal_wall", [] ],
				["4399544512", "internal_wall", [] ],
				["4399667752", "internal_wall", [] ],
				["4399543792", "internal_wall", [] ],
				["4398169768", "internal_wall", [] ],
				["4399574048", "internal_wall", [] ],
				["4399574192", "internal_wall", [] ],
				["4399574120", "internal_wall", [] ],
				["4421603408", "internal_wall", [] ],
				["4399667824", "internal_wall", [] ],
				["4399675368", "internal_wall", [] ],
				["4421548944", "internal_wall", [] ],
				["4421582000", "internal_wall", [] ],
				["4421604704", "internal_wall", [] ],
				["4421606288", "internal_wall", [] ],
				["4421607008", "internal_wall", [] ],
				["4421561736", "internal_wall", [] ],
				["4421580848", "internal_wall", [] ],
				["4421581640", "internal_wall", [] ],
				["4421579408", "internal_wall", [] ],
				["4421604272", "internal_wall", [] ],
				["4421558352", "internal_wall", [] ],
				["4421561160", "internal_wall", [] ],
				["4421632512", "internal_wall", [] ],
				["4421580560", "internal_wall", [] ],
				["4421573664", "internal_wall", [] ],
				["4421571504", "internal_wall", [] ],
				["4421568128", "internal_wall", [] ],
				["4421633160", "internal_wall", [] ],
				["4421634168", "internal_wall", [] ],
				["4421633808", "internal_wall", [] ],
				["4421584512", "internal_wall", [] ],
				["4421566760", "internal_wall", [] ],
				["4421567984", "internal_wall", [] ],
				["4421569640", "internal_wall", [] ],
				["4421635104", "internal_wall", [] ],
				["4421586096", "internal_wall", [] ],
				["4421583936", "internal_wall", [] ],
				["4421584296", "internal_wall", [] ],
				["4421569352", "internal_wall", [] ],
				["4421631872", "internal_wall", [] ],
				["4421630864", "internal_wall", [] ],
				["4569923952", "internal_wall", [] ],
				["4421628272", "internal_wall", [] ],
				["4421610312", "internal_wall", [] ],
				["4862172480", "internal_wall", [] ],
				["4421609232", "internal_wall", [] ],
				["4862202728", "internal_wall", [] ],
				["4569926328", "internal_wall", [] ],
				["4569927408", "internal_wall", [] ],
				["4421549736", "internal_wall", [] ],
				["4617537872", "internal_wall", [] ],
				["4862170896", "internal_wall", [] ],
				["4421629928", "internal_wall", [] ],
				["4862291264", "internal_wall", [] ],
				["4862171328", "internal_wall", [] ],
				["4862318352", "internal_wall", [] ],
				["4862234568", "internal_wall", [] ],
				["4862259928", "internal_wall", [] ],
				["4862262808", "internal_wall", [] ],
				["4862288456", "internal_wall", [] ],
				["4862386120", "internal_wall", [] ],
				["4421611032", "internal_wall", [] ],
				["4862414576", "internal_wall", [] ],
				["4862291336", "internal_wall", [] ],
				["4862446264", "internal_wall", [] ],
				["4862353064", "internal_wall", [] ],
				["4862472992", "internal_wall", [] ],
				["4862384896", "internal_wall", [] ],
				["4862411480", "internal_wall", [] ],
				["4862508928", "internal_wall", [] ],
				["4862232408", "internal_wall", [] ],
				["4862533144", "internal_wall", [] ],
				["4862413640", "internal_wall", [] ],
				["4862565120", "internal_wall", [] ],
				["4862445976", "internal_wall", [] ],
				["4862592208", "internal_wall", [] ],
				["4862508208", "internal_wall", [] ],
				["4862530264", "internal_wall", [] ],
				["4862531920", "internal_wall", [] ],
				["4862382808", "internal_wall", [] ],
				["4862660192", "internal_wall", [] ],
				["4862532856", "internal_wall", [] ],
				["4862691376", "internal_wall", [] ],
				["4862563968", "internal_wall", [] ],
				["4862719184", "internal_wall", [] ],
				["4862623328", "internal_wall", [] ],
				["4862657312", "internal_wall", [] ],
				["4862659760", "internal_wall", [] ],
				["4862505760", "internal_wall", [] ],
				["4862783144", "internal_wall", [] ],
				["4862659040", "internal_wall", [] ],
				["4862814256", "internal_wall", [] ],
				["4862690440", "internal_wall", [] ],
				["4862752384", "internal_wall", [] ],
				["4421638984", "internal_wall", [] ],
				["4862780264", "internal_wall", [] ],
				["4862782640", "internal_wall", [] ],
				["4569976984", "internal_wall", [] ],
				["4862813968", "internal_wall", [] ],
				["4862621240", "internal_wall", [] ],
				["4421637400", "internal_wall", [] ],
				["4421639200", "internal_wall", [] ],
				["4862719688", "internal_wall", [] ],
				["4569979720", "internal_wall", [] ],
				["4569980008", "internal_wall", [] ],
				["4421595936", "internal_wall", [] ],
				["4569869488", "internal_wall", [] ],
				["4569868480", "internal_wall", [] ],
				["4569867760", "internal_wall", [] ],
				["4421598456", "internal_wall", [] ],
				["4421596080", "internal_wall", [] ],
				["4617493320", "internal_wall", [] ],
				["4421596368", "internal_wall", [] ],
				["4569979792", "internal_wall", [] ],
				["4569870848", "internal_wall", [] ],
				["4421562808", "internal_wall", [] ],
				
				["4422082360", "corridor_wall", [] ],
				["4422094360", "corridor_wall", [] ],
				["4422392504", "corridor_wall", [] ],
				["4422392576", "corridor_wall", [] ],
				["4617314528", "corridor_wall", [] ],
				["4617318840", "corridor_wall", [] ],
				["4617318128", "corridor_wall", [] ],
				["4422103984", "corridor_wall", [] ],
				["4617318480", "corridor_wall", [] ],
				["4617314384", "corridor_wall", [] ],
				["4617313240", "corridor_wall", [] ],
				["4617315824", "corridor_wall", [] ],
				["4617321360", "corridor_wall", [] ],
				["4422103336", "corridor_wall", [] ],
				["4422124608", "corridor_wall", [] ],
				["4422106504", "corridor_wall", [] ],
				["4422107008", "corridor_wall", [] ],
				["4617311944", "corridor_wall", [] ],
				["4422392936", "corridor_wall", [] ],
				["4422125472", "corridor_wall", [] ],
				["4422125040", "corridor_wall", [] ],
				["4422124248", "corridor_wall", [] ],
				["4617312304", "corridor_wall", [] ],
				["4422107576", "corridor_wall", [] ],
				["4422114552", "corridor_wall", [] ],
				["4422113328", "corridor_wall", [] ],
				["4422111888", "corridor_wall", [] ],
				["4422107360", "corridor_wall", [] ],
				["4422134960", "corridor_wall", [] ],
				["4422107936", "corridor_wall", [] ],
				["4422110960", "corridor_wall", [] ],
				["4422139416", "corridor_wall", [] ],
				["4422135752", "corridor_wall", [] ],
				["4422134888", "corridor_wall", [] ],
				["4422133592", "corridor_wall", [] ],
				["4422149400", "corridor_wall", [] ],
				["4422136320", "corridor_wall", [] ],
				["4422138264", "corridor_wall", [] ],
				["4422137040", "corridor_wall", [] ],
				["4422144584", "corridor_wall", [] ],
				["4422148896", "corridor_wall", [] ],
				["4422151272", "corridor_wall", [] ],
				["4422101688", "corridor_wall", [] ],
				["4422137976", "corridor_wall", [] ],
				["4422145448", "corridor_wall", [] ],
				["4422147968", "corridor_wall", [] ],
				["4422145664", "corridor_wall", [] ],
				["4422151128", "corridor_wall", [] ],
				["4422102696", "corridor_wall", [] ],
				["4422418512", "corridor_wall", [] ],
				["4422107720", "corridor_wall", [] ],
				["4422130576", "corridor_wall", [] ],
				["4422131584", "corridor_wall", [] ],
				["4422130648", "corridor_wall", [] ],
				["4422419520", "corridor_wall", [] ],
				["4422419808", "corridor_wall", [] ],
				["4422418872", "corridor_wall", [] ],
				["4422413704", "corridor_wall", [] ],
				["4422403784", "corridor_wall", [] ],
				["4422402416", "corridor_wall", [] ],
				["4422402704", "corridor_wall", [] ],
				["4422403568", "corridor_wall", [] ],
				["4422424912", "corridor_wall", [] ],
				["4422410824", "corridor_wall", [] ],
				["4422411328", "corridor_wall", [] ],
				["4422421680", "corridor_wall", [] ],
				["4422423904", "corridor_wall", [] ],
				["4422424984", "corridor_wall", [] ],
				["4422425560", "corridor_wall", [] ],
				["4422423832", "corridor_wall", [] ],
				["4422434760", "corridor_wall", [] ],
				["4422442160", "corridor_wall", [] ],
				["4422440720", "corridor_wall", [] ],
				["4422442880", "corridor_wall", [] ],
				["4422431088", "corridor_wall", [] ],
				["4422431592", "corridor_wall", [] ],
				["4422433968", "corridor_wall", [] ],
				["4422433536", "corridor_wall", [] ],
				["4422428504", "corridor_wall", [] ],
				["4422447976", "corridor_wall", [] ],
				["4422447688", "corridor_wall", [] ],
				["4422450280", "corridor_wall", [] ],
				["4422460048", "corridor_wall", [] ],
				["4422427424", "corridor_wall", [] ],
				["4422429656", "corridor_wall", [] ],
				["4422430520", "corridor_wall", [] ],
				["4422454664", "corridor_wall", [] ],
				["4422459832", "corridor_wall", [] ],
				["4422461992", "corridor_wall", [] ],
				["4422460336", "corridor_wall", [] ],
				["4422430664", "corridor_wall", [] ],
				["4421639848", "corridor_wall", [] ],
				["4422451424", "corridor_wall", [] ],
				["4422451496", "corridor_wall", [] ],
				["4422462280", "corridor_wall", [] ],
				["4422171392", "corridor_wall", [] ],
				["4422456024", "corridor_wall", [] ],
				["4617539528", "corridor_wall", [] ],
				["4422456528", "corridor_wall", [] ],
				["4422169304", "corridor_wall", [] ],
				["4422169664", "corridor_wall", [] ],
				["4422172544", "corridor_wall", [] ]
			]
		]

def codex(pair, parentName, out):
	newName = parentName + "_" + pair[0]
	out += [ (newName, pair[1]) ]
	pair.append(newName)
	if len(pair[2]) > 0:
		for element in pair[2]:
			codex(element, pair[-1],out)

import copy
floors = [ copy.deepcopy(names) for k in range(6) ]
for k,floor in enumerate(floors):
	floors[k] = [floor[0]+"_"+str(k), floor[1], floor[2]]

building = [ "sogei","building", floors]
nomi_classi = []
codex(building, "torre", nomi_classi)




##############################################



""" import modules from larcc/lib """
import sys
sys.path.insert(0, 'lib/py/')
from hijson import *
from iot3d import *

scaleFactor = 83.333

filename = "test/py/inters/plan.svg"
larModel = svg2lar(filename)
larModel = larApply(s(scaleFactor,scaleFactor))(larModel)
V,FV,EV = larModel
FV[2] += FV[71]      # for now :o)

""" Assembling floor layout generation """
""" Visualization of cell numbering in a 2D complex """
VV = AA(LIST)(range(len(V)))
submodel = STRUCT(MKPOLS((V,EV)))
VIEW(larModelNumbering(1,1,1)(V,[VV,EV,FV[:-1]],submodel,2.5))

FE = crossRelation(FV,EV)


##############################################


data = [[[28,99,41,63,86,102,5,4,105],
 [83,81,49,80,23,98,91,13,53],
 [12],
 [77, 48],
 [19],
 [95, 47, 31]],
[[8, 14, 27, 36, 37, 44, 62, 69, 75, 85, 94],
 [1, 24, 40, 50, 60, 61, 65, 87, 92],
 [25],
 [3],
 [66],
 [10, 11, 52, 89, 108]],
[[20, 21, 30, 67, 70, 88, 90, 96, 107, 110],
 [0, 51, 58, 59, 68, 78, 84, 93],
 [29],
 [56],
 [34],
 [16, 76]],
[[7, 9, 17, 18, 35, 38, 39, 46, 64, 79, 100, 101, 103, 111],
 [22, 32, 33, 42, 45, 55, 73, 74, 97, 106, 109, 112],
 [6],
 [43, 57],
 [82],
 [104, 54]],
[[],[],[2],[],[15, 26]]]

boundaryEdges = boundaryCells(FV[:-1], EV)
corridorEdges = list(set(CAT([FE[k] for k in [6, 12, 25, 29]])).difference(boundaryEdges))
internalEdges = list(set(range(len(EV))).difference(boundaryEdges+corridorEdges))

wallTypes = [boundaryEdges, corridorEdges, internalEdges]


cellHierarchy = data 

###############################################



def to_pair (item):
  if type(item) is int:
	origin = tuple(AA(min)(TRANS([V[v] for v in FV[item]])))
	pair = (origin,[item])
	return pair
  else:
	items =[x for x in item if type(x) is not list or x !=[]]
	pairs = AA(to_pair)(items)
	origins = AA(S1)(pairs)
	origin = (min(AA(S1)(origins)), min(AA(S2)(origins)))
	pair = (origin, pairs)
	return pair
	
pair = to_pair(cellHierarchy)


def to_struct (params):
	p_origin, parent = params
	c_origin, c_pairs = parent
	cell = c_pairs[0]
	origin = VECTDIFF([c_origin, p_origin])
	if type(cell) is int:        
		c_x,c_y = c_origin
		verts = larTranslate([-c_x,-c_y])([V[v] for v in FV[cell]])
		fvDict = dict([(v,k) for k,v in enumerate(FV[cell])])
		model = (verts,[range(len(verts))],[[fvDict[v] for v in EV[e]] for e in FE[cell]])
		return Struct([t(*origin), model])
	else:
		return Struct([t(*origin)] + AA(to_struct)(DISTL([c_origin, c_pairs])) )

###############################################

boundaryEdges = boundaryCells(FV[:-1], EV)
corridorEdges = list(set(CAT([FE[k] for k in [6, 12, 25, 29]])).difference(boundaryEdges))
internalEdges = set(range(len(EV))).difference(boundaryEdges+corridorEdges)

boundaryWalls = AA(COLOR(CYAN))(MKPOLS((V,[EV[k] for k in boundaryEdges])))
internalWalls = AA(COLOR(MAGENTA))(MKPOLS((V,[EV[k] for k in internalEdges])))
corridorWalls = AA(COLOR(YELLOW))(MKPOLS((V,[EV[k] for k in corridorEdges])))

VIEW(EXPLODE(1.2,1.2,1.2)(boundaryWalls+internalWalls+corridorWalls))


###############################################


def walls(listOfEdges, kind="feature"):
	wallStructs = []
	for e in listOfEdges:
		eVect = VECTDIFF([ V[EV[e][1]], V[EV[e][0]] ])
		eSize = VECTNORM( eVect )
		v,ev,fv = [ [0.0, 0.0], [eSize, 0.0] ],  [ [0,1] ], [ [0,1] ]
		v,ev,fv = [ [0.0, 0.0], [eSize, 0.0] ],  [ [0,1] ], [ [0,1] ]
		model = v, ev
		#tvect = V[EV[e][0]]
		tvect = VECTDIFF([ V[EV[e][0]], [0,8.4166,0] ])
		angle = math.atan2(eVect[1],eVect[0])
		wallStructs += [ Struct( [t(*tvect), r(angle), model], category=kind) ]
	return Struct( wallStructs )

external_edges = walls( boundaryEdges, kind="external_wall" )
internal_edges = walls( internalEdges, kind="internal_wall" )
corridor_edges = walls( corridorEdges, kind="corridor_wall" )

Vwalls,EZ = struct2lar(Struct(external_edges))
translation = AA(min)(TRANS(Vwalls)) + [0.0]

#VIEW(EXPLODE(1.2,1.2,1.2)(MKPOLS(struct2lar(
#    Struct([ external_edges, internal_edges, corridor_edges ])
#    ))))

###############################################


piano_2D = to_struct([pair[0], pair])
piano_2D.body = piano_2D.body + external_edges.body + internal_edges.body + corridor_edges.body

#W,WF,WE = struct2lar(piano_2D)
##VIEW(EXPLODE(1.2,1.2,1.2)(MKPOLS( (W,WE) )))

piano = embedStruct(1)(piano_2D)


###############################################



torre = Struct( CAT([[ piano.clone(), t(0,0,4) ] for k in range(6)]))
W,WE = struct2lar(torre)
#VIEW(EXPLODE(1.2,1.2,1.2)(MKPOLS( (W,WE) )))




###############################################



def traverseStruct(obj,out):
	for k,element in enumerate(obj.body):
		if isinstance(element,Struct): 
			out += [id(element)]
			traverseStruct(element, out)
	return out

out_structs = traverseStruct(torre,[id(torre)])

import ctypes

def id2obj(objId):
	return ctypes.cast(objId, ctypes.py_object).value


for ID,(name,category) in zip(out_structs,nomi_classi):
	element = id2obj(ID)
	element.name = name
	element.category = category


	
###############################################


wall_categories = ["internal_wall", "external_wall", "corridor_wall"]

room_categories = ["room"]

indent = 2 * " "

def get_id(obj, father_id):
	return father_id + '_' + obj.name

def is_struct(obj):
	return isinstance(obj, Struct)
   
def is_wall(obj):
	return obj.category in wall_categories

def is_room(obj):
	return obj.category in room_categories

def is_model(obj):
	return isinstance(obj, Model)

def is_mat(obj):
	return isinstance(obj,Mat)

def is_list(obj):
	return isinstance(obj, tuple) or isinstance(obj, list)

def print_wall(out, obj, parent_id):
	obj_id = get_id(obj, parent_id)
	edge = evalStruct(obj)[0][0]
	category = obj.category
	tvect = obj.box[0]
	print >> out, "-   ", "id:", obj_id
	print >> out, indent, "type:", "Feature"
	print >> out, indent, "geometry:" 
	print >> out, indent+indent, "type:", "LineString"
	print >> out, indent+indent, "coordinates:", edge
	print >> out, indent, "properties:"
	print "category=", category
	print >> out, indent+indent, "class:", category
	print >> out, indent+indent, "parent:", parent_id
	print >> out, indent+indent, "description:", ""
	print >> out, indent+indent, "tVector:", [tvect[0],tvect[1],tvect[2]]
	print >> out, indent+indent, "rVector:", [0, 0, 0]  


def transformCycle(transfMat,cycle):
	affineCoordinates = [point+[1] for point in cycle]
	localCoords = (transfMat.dot(array(affineCoordinates).T)).T
	localCoordinates = [[x,y,z] for x,y,z,w in localCoords.tolist()]
	return localCoordinates

def print_struct(out, obj, parent_id):
	tvect = obj.box[0]
	import hijson
	V,boundaryEdges = hijson.structBoundaryModel(obj)   
	coordinates = hijson.boundaryModel2polylines((V,boundaryEdges))
	transfMat = array(t(*[-x for x in tvect]))   
	coordinates = [transformCycle(transfMat,cycle) for cycle in coordinates]
	category = obj.category
	
	print >> out, "-   ","id:", name
	print >> out, indent,"type:", "Feature"
	print >> out, indent,"geometry:" 
	print >> out, indent+indent, "type:", "Polygon"
	print >> out, indent+indent, "coordinates:", coordinates
	print >> out, indent,"properties:"
	print "category=", category
	print >> out, indent+indent, "class:", category
	print >> out, indent+indent, "parent:", parent_id
	print >> out, indent+indent, "description:", ""
	print >> out, indent+indent, "tVector:", [tvect[0],tvect[1],tvect[2]]
	print >> out, indent+indent, "rVector:", [0, 0, 0]

def print_model(out, obj, parent_id):
	obj_id = get_id(obj, parent_id)
	category = obj.category
	verts,cells = obj
	tvect = obj.box[0]
	print >> out, "-   ", "id:", obj_id
	print >> out, indent, "type:", "Feature"
	print >> out, indent, "geometry:" 
	print >> out, indent+indent, "type:", "Polygon"
	print >> out, indent+indent, "coordinates:", AA(eval)(AA(vcode)(verts))
	print >> out, indent, "properties:"
	print >> out, indent+indent, "class:", category
	print >> out, indent+indent, "parent:", parent_id
	print >> out, indent+indent, "description:", ""
	print >> out, indent+indent, "tVector:", [tvect[0],tvect[1],tvect[2]]
	print >> out, indent+indent, "rVector:", [0, 0, 0]

def print_mat(out, obj, parent_id):
	print >> out, indent+indent, "tVector:", obj.T[-1,:-1].tolist()


def print_traversal(out, obj, parent_id='', level=0): 

	if is_struct(obj):

		if is_wall(obj):
			print_wall(out, obj, parent_id)
			return

		print_struct(out, obj, parent_id)

		parent_id = get_id(obj, parent_id)
		print_traversal(out, obj.body, parent_id)
		return

	if is_model(obj):
		print_model(out, obj, parent_id)
		return

	if is_list(obj):
		parent_id = get_id(obj, parent_id)      
		print_traversal(out, obj[0], parent_id)
		
		if len(obj) > 1:
			print_traversal(out, obj[1:], parent_id)
	
		return
	
	if is_mat(obj):
		print_mat(out, obj, parent_id)
		return

def printStruct2GeoJson(path, struct):
	if struct.__name__() == None:
		filename = str(id(struct))
	else: 
		filename = struct.__name__()
	out = open(path+filename+".yml", "w")
	print >> out, "---"
	print "filename =", path+filename+".yml"
	dim = checkStruct(struct.body)
	CTM, stack = scipy.identity(dim+1), []
	fathers = [filename]
	#import pdb; pdb.set_trace()

	import hijson
	V,boundaryEdges = hijson.structBoundaryModel(struct)   #+new
	boundaryPolygons = hijson.boundaryModel2polylines((V,boundaryEdges))  #+new
	
	print_traversal(out, struct) 

	out.close()



###############################################


printStruct2GeoJson("./",torre)




#VIEW(STRUCT(MKPOLS((V,[EV[e] for e in CAT(wallTypes)]))))

dict(zip(torre.body[0].body[6:],CAT(wallTypes)))

coboundary = boundary(EV,FV)
